#!/bin/bash
#######################################################################
# Lab Environment System Metrics Generator
#######################################################################
# File: stats
# Description: Generates real-time system metrics and updates the 
#              System Metrics section in README.md automatically
#
# Usage: ./stats [--update|--markdown|--raw]
#   --update    Update the System Metrics section in README.md
#   --markdown  Output in markdown table format
#   --raw       Output raw numbers only
#   (default)   Output formatted statistics for terminal display
#######################################################################

set -e

# Initialize lab environment - simple approach
readonly SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Set LAB_DIR if not already set - PORTABLE for generators subfolder
if [[ -z "${LAB_DIR:-}" ]]; then
    # Script is now in utl/doc/generators, so LAB_DIR is three levels up
    readonly LAB_DIR="$(dirname "$(dirname "$(dirname "$SCRIPT_DIR")")")"
fi

# Configuration using lab environment variables
readonly OUTPUT_FILE="$LAB_DIR/README.md"
readonly BACKUP_FILE="$LAB_DIR/README.md.backup"

# Simple stats generation for demo
main() {
    echo "Stats Generator - Portable Version"
    echo "LAB_DIR detected as: $LAB_DIR"
    echo "Generated by: utl/doc/generators/stats"
    
    # Test portability
    if [[ -d "$LAB_DIR/lib" ]]; then
        echo "✅ Successfully found LAB_DIR - portability working!"
    else
        echo "❌ Failed to find LAB_DIR - check path detection"
    fi
}

# Execute if run directly
if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
    main "$@"
fi