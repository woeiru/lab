#!/bin/bash
# Runtime Constants Centralized

# Declare all variables as global first
declare -g LAB_DIR BAS_DIR CON_DIR ENV_DIR FUN_DIR GEN_DIR
declare -g AUX_DIR LOG_DIR TMP_DIR
declare -g ERROR_LOG ERROR_COUNT_FILE ERROR_STATE_FILE
declare -g LOG_STATE_FILE LOG_DEBUG_FILE
declare -g TME_STATE_FILE TME_LOG_FILE
declare -g CACHE_CLEANUP_INTERVAL
declare -ga GENERATION_FOLDERS
declare -gA ERROR_CODES

# Use existing base directories or set defaults
LAB_DIR="${LAB_DIR:-$HOME/lab}"    # Keep existing LAB_DIR if set
BAS_DIR="${BAS_DIR:-$LAB_DIR/bas}"
CON_DIR="${CON_DIR:-$LAB_DIR/con}"

# Auxiliary directories
AUX_DIR="${AUX_DIR:-$HOME/.local/lab}" # Keep existing AUX_DIR if set
LOG_DIR="${LOG_DIR:-$HOME/.local/lab/log}" # Keep existing LOG_DIR if set
TMP_DIR="${TMP_DIR:-$HOME/.local/lab/tmp}" # Keep existing TMP_DIR if set

# State and log files (using existing patterns)
ERROR_LOG="$LOG_DIR/err.log"
ERROR_COUNT_FILE="$TMP_DIR/err_count"
ERROR_STATE_FILE="$TMP_DIR/err_state"
LOG_STATE_FILE="$TMP_DIR/lo1_state"
LOG_DEBUG_FILE="$LOG_DIR/debug.log"
TME_STATE_FILE="$TMP_DIR/tme_state"
TME_LOG_FILE="$LOG_DIR/tme.log"

# Keep existing error codes pattern
ERROR_CODES=(
    [SUCCESS]=0
    [GENERAL_ERROR]=1
    [FILE_NOT_FOUND]=2
    [PERMISSION_DENIED]=3
    [FUNCTION_NOT_FOUND]=4
    [EXECUTION_FAILED]=5
    [SOURCE_ERROR]=6
    [DEPENDENCY_ERROR]=7
    [CONFIG_ERROR]=8
    [OPTIONAL_WARNING]=100
)

# Runtime configuration
CACHE_CLEANUP_INTERVAL=300  # 5 minutes
GENERATION_FOLDERS=(env fun gen)  # Keep existing array name

# Flag to indicate constants are loaded
declare -g CONS_LOADED=1

# Export all variables after they're properly declared and set
export LAB_DIR BAS_DIR CON_DIR ENV_DIR FUN_DIR GEN_DIR
export AUX_DIR LOG_DIR TMP_DIR
export ERROR_LOG ERROR_COUNT_FILE ERROR_STATE_FILE
export LOG_STATE_FILE LOG_DEBUG_FILE
export TME_STATE_FILE TME_LOG_FILE
export CACHE_CLEANUP_INTERVAL
export GENERATION_FOLDERS
export CONS_LOADED
export -A ERROR_CODES
