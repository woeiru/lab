---
- name: Ensure .config directory exists
  file:
    path: "{{ ansible_env.HOME }}/.config"
    state: directory
    mode: '0755'

- name: Configure all shortcuts
  lineinfile:
    path: "{{ ansible_env.HOME }}/.config/kglobalshortcutsrc"
    regexp: "^{{ item.option }}="
    line: "{{ item.option }}={{ item.value }}"
  loop:
    # Global shortcuts
    - { option: "kwin.ExposeAll", value: "Ctrl+F10\\tLaunch (C)\\tMeta+Tab,Ctrl+F10\\tLaunch (C),Toggle Present Windows (All desktops)" }
    - { option: "kwin.Window Close", value: "Alt+F4\\tMeta+Backspace,Alt+F4,Close Window" }
    - { option: "org.kde.kglobalaccel.Sleep", value: "Meta+Del,Sleep,Sleep,Suspend" }
    - { option: "plasmashell.show-on-mouse-pos", value: "Meta+`\\tMeta+V,Meta+V,Show Clipboard Items at Mouse Position" }
    # Custom shortcuts
    - { option: "services.net.local.bash-2.desktop._launch", value: "Meta+End,,Switch to Dark Theme" }
    - { option: "services.net.local.bash.desktop._launch", value: "Meta+Home,,Switch to Light Theme" }
    - { option: "services.org.kde.konsole.desktop.NewWindow", value: "Meta+Return,,Open Terminal" }

- name: Create custom shortcut files
  copy:
    content: "{{ item.content }}"
    dest: "{{ ansible_env.HOME }}/.local/share/applications/{{ item.filename }}"
    mode: '0644'
  loop:
    - filename: "net.local.bash-2.desktop"
      content: |
        [Desktop Entry]
        Exec=bash -c -i "theme-preset-dark"
        Name=Switch to Dark Theme
        NoDisplay=true
        StartupNotify=false
        Type=Application
        X-KDE-GlobalAccel-CommandShortcut=true
    - filename: "net.local.bash.desktop"
      content: |
        [Desktop Entry]
        Exec=bash -c -i "theme-preset-bright"
        Name=Switch to Light Theme
        NoDisplay=true
        StartupNotify=false
        Type=Application
        X-KDE-GlobalAccel-CommandShortcut=true

- name: Notify user to restart KDE
  debug:
    msg: "Shortcut configuration complete. Please restart your KDE session (log out and log back in) to ensure all changes take effect."
